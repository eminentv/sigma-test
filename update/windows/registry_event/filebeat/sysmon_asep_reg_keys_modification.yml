alert:
- debug
description: Detects modification of autostart extensibility point (ASEP) in registry.
filter:
- query:
    query_string:
      query: ((((((((((((TargetObject.keyword:(*\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows\ CE\ Services\\AutoStart* OR *\\Software\\Wow6432Node\\Microsoft\\Command\ Processor\\Autorun* OR *\\SOFTWARE\\Wow6432Node\\Microsoft\\Active\ Setup\\Installed\ Components* OR *\\SOFTWARE\\Microsoft\\Windows\ CE\ Services\\AutoStartOnDisconnect* OR *\\SOFTWARE\\Microsoft\\Windows\ CE\ Services\\AutoStartOnConnect* OR *\\SYSTEM\\Setup\\CmdLine* OR *\\Software\\Microsoft\\Ctf\\LangBarAddin* OR *\\Software\\Microsoft\\Command\ Processor\\Autorun* OR *\\SOFTWARE\\Microsoft\\Active\ Setup\\Installed\ Components* OR *\\SOFTWARE\\Classes\\Protocols\\Handler* OR *\\SOFTWARE\\Classes\\Protocols\\Filter* OR *\\SOFTWARE\\Classes\\Htmlfile\\Shell\\Open\\Command\\\(Default\)* OR *\\Environment\\UserInitMprLogonScript* OR *\\SOFTWARE\\Policies\\Microsoft\\Windows\\Control\ Panel\\Desktop\\Scrnsave.exe* OR *\\Software\\Microsoft\\Internet\ Explorer\\UrlSearchHooks* OR *\\SOFTWARE\\Microsoft\\Internet\ Explorer\\Desktop\\Components* OR *\\Software\\Classes\\Clsid\\\{AB8902B4\-09CA\-4bb6\-B78D\-A8F59079A8D5\}\\Inprocserver32* OR *\\Control\ Panel\\Desktop\\Scrnsave.exe*) OR (TargetObject.keyword:*\\System\\CurrentControlSet\\Control\\Session\ Manager* AND TargetObject.keyword:(*\\SetupExecute* OR *\\S0InitialCommand* OR *\\KnownDlls* OR *\\Execute* OR *\\BootExecute* OR *\\AppCertDlls*))) OR (TargetObject.keyword:*\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion* AND TargetObject.keyword:(*\\ShellServiceObjectDelayLoad* OR *\\Run* OR *\\Policies\\System\\Shell* OR *\\Policies\\Explorer\\Run* OR *\\Group\ Policy\\Scripts\\Startup* OR *\\Group\ Policy\\Scripts\\Shutdown* OR *\\Group\ Policy\\Scripts\\Logon* OR *\\Group\ Policy\\Scripts\\Logoff* OR *\\Explorer\\ShellServiceObjects* OR *\\Explorer\\ShellIconOverlayIdentifiers* OR *\\Explorer\\ShellExecuteHooks* OR *\\Explorer\\SharedTaskScheduler* OR *\\Explorer\\Browser\ Helper\ Objects* OR *\\Authentication\\PLAP\ Providers* OR *\\Authentication\\Credential\ Providers* OR *\\Authentication\\Credential\ Provider\ Filters*))) OR (TargetObject.keyword:*\\SOFTWARE\\Microsoft\\Windows\ NT\\CurrentVersion* AND TargetObject.keyword:(*\\Winlogon\\VmApplet* OR *\\Winlogon\\Userinit* OR *\\Winlogon\\Taskman* OR *\\Winlogon\\Shell* OR *\\Winlogon\\GpExtensions* OR *\\Winlogon\\AppSetup* OR *\\Winlogon\\AlternateShells\\AvailableShells* OR *\\Windows\\IconServiceLib* OR *\\Windows\\Appinit_Dlls* OR *\\Image\ File\ Execution\ Options* OR *\\Font\ Drivers* OR *\\Drivers32* OR *\\Windows\\Run* OR *\\Windows\\Load*))) OR (TargetObject.keyword:*\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion* AND TargetObject.keyword:(*\\ShellServiceObjectDelayLoad* OR *\\Run* OR *\\Explorer\\ShellServiceObjects* OR *\\Explorer\\ShellIconOverlayIdentifiers* OR *\\Explorer\\ShellExecuteHooks* OR *\\Explorer\\SharedTaskScheduler* OR *\\Explorer\\Browser\ Helper\ Objects*))) OR (TargetObject.keyword:*\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows\ NT\\CurrentVersion* AND TargetObject.keyword:(*\\Windows\\Appinit_Dlls* OR *\\Image\ File\ Execution\ Options* OR *\\Drivers32*))) OR ((TargetObject.keyword:*\\Software\\Wow6432Node\\Microsoft\\Office* OR TargetObject.keyword:*\\Software\\Microsoft\\Office*) AND TargetObject.keyword:(*\\Word\\Addins* OR *\\PowerPoint\\Addins* OR *\\Outlook\\Addins* OR *\\Onenote\\Addins* OR *\\Excel\\Addins* OR *\\Access\\Addins* OR *test\\Special\\Perf*))) OR ((TargetObject.keyword:*\\Software\\Wow6432Node\\Microsoft\\Internet\ Explorer* OR TargetObject.keyword:*\\Software\\Microsoft\\Internet\ Explorer*) AND TargetObject.keyword:(*\\Toolbar* OR *\\Extensions* OR *\\Explorer\ Bars*))) OR (TargetObject.keyword:*\\Software\\Wow6432Node\\Classes* AND TargetObject.keyword:(*\\Folder\\ShellEx\\ExtShellFolderViews* OR *\\Folder\\ShellEx\\DragDropHandlers* OR *\\Folder\\ShellEx\\ColumnHandlers* OR *\\Directory\\Shellex\\DragDropHandlers* OR *\\Directory\\Shellex\\CopyHookHandlers* OR *\\CLSID\\\{AC757296\-3522\-4E11\-9862\-C17BE5A1767E\}\\Instance* OR *\\CLSID\\\{ABE3B9A4\-257D\-4B97\-BD1A\-294AF496222E\}\\Instance* OR *\\CLSID\\\{7ED96837\-96F0\-4812\-B211\-F13C24117ED3\}\\Instance* OR *\\CLSID\\\{083863F1\-70DE\-11d0\-BD40\-00A0C911CE86\}\\Instance* OR *\\AllFileSystemObjects\\ShellEx\\DragDropHandlers* OR *\\ShellEx\\PropertySheetHandlers* OR *\\ShellEx\\ContextMenuHandlers*))) OR (TargetObject.keyword:*\\Software\\Classes* AND TargetObject.keyword:(*\\Folder\\ShellEx\\ExtShellFolderViews* OR *\\Folder\\ShellEx\\DragDropHandlers* OR *\\Folder\\Shellex\\ColumnHandlers* OR *\\Filter* OR *\\Exefile\\Shell\\Open\\Command\\\(Default\)* OR *\\Directory\\Shellex\\DragDropHandlers* OR *\\Directory\\Shellex\\CopyHookHandlers* OR *\\CLSID\\\{AC757296\-3522\-4E11\-9862\-C17BE5A1767E\}\\Instance* OR *\\CLSID\\\{ABE3B9A4\-257D\-4B97\-BD1A\-294AF496222E\}\\Instance* OR *\\CLSID\\\{7ED96837\-96F0\-4812\-B211\-F13C24117ED3\}\\Instance* OR *\\CLSID\\\{083863F1\-70DE\-11d0\-BD40\-00A0C911CE86\}\\Instance* OR *\\Classes\\AllFileSystemObjects\\ShellEx\\DragDropHandlers* OR *\\.exe* OR *\\.cmd* OR *\\ShellEx\\PropertySheetHandlers* OR *\\ShellEx\\ContextMenuHandlers*))) OR (TargetObject.keyword:*\\Software\\Policies\\Microsoft\\Windows\\System\\Scripts* AND TargetObject.keyword:(*\\Startup* OR *\\Shutdown* OR *\\Logon* OR *\\Logoff*))) OR (TargetObject.keyword:*\\System\\CurrentControlSet\\Services\\WinSock2\\Parameters* AND TargetObject.keyword:(*\\Protocol_Catalog9\\Catalog_Entries* OR *\\NameSpace_Catalog5\\Catalog_Entries*))) OR (TargetObject.keyword:*\\SYSTEM\\CurrentControlSet\\Control* AND TargetObject.keyword:(*\\Terminal\ Server\\WinStations\\RDP\-Tcp\\InitialProgram* OR *\\Terminal\ Server\\Wds\\rdpwd\\StartupPrograms* OR *\\SecurityProviders\\SecurityProviders* OR *\\SafeBoot\\AlternateShell* OR *\\Print\\Providers* OR *\\Print\\Monitors* OR *\\NetworkProvider\\Order* OR *\\Lsa\\Notification\ Packages* OR *\\Lsa\\Authentication\ Packages* OR *\\BootVerificationProgram\\ImagePath*)))
index: filebeat-*
name: 17f878b8-9968-4578-b814-c4217fc5768c-Autorun-Keys-Modification
priority: 3
realert:
  minutes: 0
type: any

import: BaseHive.config
import: BaseTeams.config
import: BaseRule.config
